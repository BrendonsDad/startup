# Debugging WebSocket

You can debug both sides of the WebSocket communication with VS Code to debug the server, and Chromechrome to debug the client. When you do this you will notice that Chrome's debugger has support specifically for working with WebSocket communication.

## Debugging the server
1. Create a directory named testWebSocket and change to that directory
2. Run npm init -y
3. Run npm install ws
4. Open VS Code and create a file name main.js and paste the following code
```js
const { WebSocketServer } = require('ws');

const wss = new WebSocketServer({ port: 3000 });

wss.on('connection', (ws) => {
  ws.on('message', (data) => {
    const msg = String.fromCharCode(...data);
    console.log('received: %s', msg);

    ws.send(`I heard you say "${msg}"`);
  });

  ws.send('Hello webSocket');
});
```

5. Set breakpoints on the ws.send lines so you can inspect the code executing

6. Start debugging by pressing f5. the first time you may need to choose node.js as the debugger.

## Debugging the Client
1. Open a Chrome browser, point it at localhost:3000 and then open the debugger by pressing f12
2. Paste Paste this code into the debugger conosle window and press enter to execute it. Executing this code will immedietly hit the server breakpoint. Take a look at what is going on and then remove the breakpoint from the server.

```js
const protocol = window.location.protocol === 'http:' ? 'ws' : 'wss';
const socket = new WebSocket(`${protocol}://${window.location.host}`);

socket.onmessage = (event) => {
  console.log('received: ', event.data);
};
```

3. Select the Network tab and then select the http messages that was generated by the executiong of the abvove client code.
4. With the http message selected, you then click the messages tab to view the websocket messages.
5. Send a message to the server by executing the following in the debugger console window. This will cause the second server breakpoint to hit. Explroe and then remove the breakpoint from the server.
6. You should see the messages in the messages debugger window